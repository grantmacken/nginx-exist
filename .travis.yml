sudo: required
dist: trusty
language: java
addons:
    apt:
        packages:
        - expect
before_install:
- echo "install latest eXist release"
- git clone https://github.com/ingydotnet/test-more-bash.git 
- ls -al .
- touch config
install:
    - make build
before_script:
    - cd $HOME/eXist
    - java -Djava.endorsed.dirs=lib/endorsed -Djava.net.preferIPv4Stack=true -jar start.jar jetty &
    - while [[ -z "$(curl -I -s -f 'http://127.0.0.1:8080/')" ]] ; do sleep 5 ; done
    - cat webapp/WEB-INF/logs/exist.log | tail -n 6
script:
    - cd $HOME/eXist
    - echo "$(echo 'sm:is-authenticated()' |  java -Djava.endorsed.dirs=lib/endorsed -jar start.jar client -sqx -u admin -P admin | tail -1)"
    - cd $HOME
    - prove
after_script:
    - cd $HOME/eXist
    - java -Djava.endorsed.dirs=lib/endorsed -jar start.jar shutdown -u admin -p admin
